// Prisma Schema for SOOTHE CMS Backend
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  EDITOR
  AUTHOR
  VIEWER
}

enum PostStatus {
  DRAFT
  PUBLISHED
}

enum JobStatus {
  OPEN
  CLOSED
}

model User {
  id           String      @id @default(uuid())
  email        String      @unique
  password     String
  firstName    String
  lastName     String
  role         UserRole    @default(VIEWER)
  isActive     Boolean     @default(true)
  refreshToken String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  
  // Relations
  blogPosts    BlogPost[]
  
  @@map("users")
}

model Settings {
  id                    String   @id @default(uuid())
  siteName              String   @default("SOOTHE TECHNOLOGIES")
  siteDescription       String?
  siteUrl               String?
  logoUrl               String?
  faviconUrl            String?
  
  // SEO Defaults
  defaultMetaTitle      String?
  defaultMetaDescription String?
  defaultOgImage        String?
  
  // Accessibility Defaults
  accessibilityEnabled  Boolean  @default(true)
  defaultFontSize       Int      @default(16)
  defaultContrast       String   @default("normal")
  
  // Social Links
  facebookUrl           String?
  twitterUrl            String?
  linkedinUrl           String?
  instagramUrl          String?
  
  // Contact
  contactEmail          String?
  contactPhone          String?
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  @@map("settings")
}

model Page {
  id               String      @id @default(uuid())
  title            String
  slug             String      @unique
  content          Json?       // Stores page blocks as JSON
  metaTitle        String?
  metaDescription  String?
  ogImage          String?
  isPublished      Boolean     @default(false)
  publishedAt      DateTime?
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  
  @@index([slug])
  @@map("pages")
}

model SolutionCategory {
  id          String     @id @default(uuid())
  name        String     @unique
  slug        String     @unique
  description String?
  icon        String?
  sortOrder   Int        @default(0)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  
  // Relations
  solutions   Solution[]
  
  @@index([slug])
  @@map("solution_categories")
}

model Solution {
  id              String            @id @default(uuid())
  title           String
  slug            String            @unique
  description     String
  longDescription String?
  icon            String?
  imageUrl        String?
  
  // Features and Benefits stored as JSON arrays
  features        Json?
  benefits        Json?
  
  // SEO
  metaTitle       String?
  metaDescription String?
  ogImage         String?
  
  // Status
  isPublished     Boolean           @default(false)
  publishedAt     DateTime?
  
  // Category relation
  categoryId      String?
  category        SolutionCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  
  sortOrder       Int               @default(0)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  
  @@index([slug])
  @@index([categoryId])
  @@map("solutions")
}

model Accessibility {
  id                    String   @id @default(uuid())
  statement             String?  @db.Text
  wcagLevel             String   @default("AA")
  guidelines            Json?    // Stores accessibility guidelines as JSON
  
  // Enabled Features
  keyboardNavigation    Boolean  @default(true)
  screenReaderSupport   Boolean  @default(true)
  highContrastMode      Boolean  @default(true)
  textResizing          Boolean  @default(true)
  altTextRequired       Boolean  @default(true)
  
  lastAuditDate         DateTime?
  nextAuditDate         DateTime?
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  @@map("accessibility")
}

model BlogPost {
  id              String     @id @default(uuid())
  title           String
  slug            String     @unique
  excerpt         String?
  content         Json       // Rich content stored as JSON
  featuredImage   String?
  
  // Author relation
  authorId        String
  author          User       @relation(fields: [authorId], references: [id], onDelete: Cascade)
  
  // Tags stored as JSON array
  tags            Json?
  
  // Auto-calculated reading time
  readingTime     Int?       // in minutes
  
  // SEO
  metaTitle       String?
  metaDescription String?
  ogImage         String?
  
  // Status
  status          PostStatus @default(DRAFT)
  publishedAt     DateTime?
  
  // Stats
  viewCount       Int        @default(0)
  
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  
  @@index([slug])
  @@index([authorId])
  @@index([status])
  @@map("blog_posts")
}

model Career {
  id                String       @id @default(uuid())
  title             String
  department        String?
  location          String?
  type              String?      // Full-time, Part-time, Contract
  description       String       @db.Text
  
  // Stored as JSON arrays
  responsibilities  Json?
  requirements      Json?
  benefits          Json?
  
  // Status
  status            JobStatus    @default(OPEN)
  
  // Salary range (optional)
  salaryMin         Int?
  salaryMax         Int?
  salaryCurrency    String?      @default("USD")
  
  // SEO
  metaTitle         String?
  metaDescription   String?
  
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  
  // Relations
  applicants        Applicant[]
  
  @@index([status])
  @@map("careers")
}

model Applicant {
  id          String   @id @default(uuid())
  firstName   String
  lastName    String
  email       String
  phone       String?
  message     String?  @db.Text
  cvUrl       String   // File path/URL to uploaded CV
  linkedinUrl String?
  
  // Career relation
  careerId    String
  career      Career   @relation(fields: [careerId], references: [id], onDelete: Cascade)
  
  // Status tracking
  status      String   @default("new") // new, reviewed, shortlisted, rejected, hired
  notes       String?  @db.Text
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([careerId])
  @@index([email])
  @@map("applicants")
}

model Team {
  id          String   @id @default(uuid())
  firstName   String
  lastName    String
  role        String
  bio         String?  @db.Text
  photoUrl    String?
  
  // Social links
  linkedinUrl String?
  twitterUrl  String?
  email       String?
  
  // Display order
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("team")
}

model ContactSubmission {
  id        String   @id @default(uuid())
  name      String
  email     String
  phone     String?
  subject   String?
  message   String   @db.Text
  
  // Admin tracking
  isRead    Boolean  @default(false)
  notes     String?  @db.Text
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([email])
  @@index([createdAt])
  @@map("contact_submissions")
}

model Media {
  id          String   @id @default(uuid())
  fileName    String
  originalName String
  mimeType    String
  size        Int      // in bytes
  url         String
  
  // For accessibility
  altText     String?
  title       String?
  description String?
  
  // Dimensions for images
  width       Int?
  height      Int?
  
  // Organization
  folder      String?  @default("/")
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([mimeType])
  @@index([folder])
  @@map("media")
}
